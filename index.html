<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Blessing of Siam</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    /* Base Styles */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Noto Sans Thai', sans-serif;
      background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
      color: #333;
      transition: background 0.5s, color 0.5s;
      position: relative;
      min-height: 100vh;
      overflow: auto;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    @media (max-width: 600px) {
  .blessing-of-day {
    top: 120px; /* More space on mobile */
    width: 95%;
    font-size: 0.9em;
    padding: 10px 15px;
  }
}

    /* Pastel Themes */
    .theme-wat-pra-kew { background: linear-gradient(135deg, #b6d0e2 0%, #89b0d9 100%); color: #333; }
    .theme-wat-po { background: linear-gradient(135deg, #f4d1bc 0%, #e9b89e 100%); color: #333; }
    .theme-wat-benchamabophit { background: linear-gradient(135deg, #f5f5f5 0%, #d9d9d9 100%); color: #333; }
    .theme-wat-phra-singh { background: linear-gradient(135deg, #f7e7a0 0%, #edd279 100%); color: #333; }
    .theme-wat-phnom-penh { background: linear-gradient(135deg, #b8d8ba 0%, #9cc09e 100%); color: #333; }
    .theme-wat-suthat { background: linear-gradient(135deg, #d6bcd6 0%, #c799c7 100%); color: #333; }
    .theme-wat-arun { background: linear-gradient(135deg, #b9d9eb 0%, #9bc8e0 100%); color: #333; }
    .theme-wat-chedi-luang { background: linear-gradient(135deg, #e8d5c4 0%, #d9b9a3 100%); color: #333; }
    .theme-wat-traimit { background: linear-gradient(135deg, #d4e4bc 0%, #bcd19b 100%); color: #333; }

    /* White Splash Effect */
    .white-splash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: radial-gradient(circle at 50% 50%, white 0%, transparent 70%);
      opacity: 0;
      z-index: 1000;
      pointer-events: none;
      display: none;
    }

    @keyframes splashEffect {
      0% { opacity: 0; }
      50% { opacity: 1; }
      100% { opacity: 0; }
    }

    /* Mandala Animation */
    .mandala {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: transparent;
      z-index: 990;
      pointer-events: none;
      display: none;
      animation: fadeOut 5s ease-in forwards;
      opacity: 1;
      transition: opacity 0.5s;
    }

    .mandala.show {
      display: block;
    }

    @keyframes mandalaCircles {
      0% { transform: scale(0.2); opacity: 0; }
      50% { transform: scale(1.5); opacity: 0.5; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes mandalaStars {
      0% { transform: scale(0.1); opacity: 0; }
      50% { transform: scale(1); opacity: 0.3; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes mandalaPetals {
      0% { transform: scale(0.1) rotate(0deg); opacity: 0; }
      50% { transform: scale(1.5) rotate(45deg); opacity: 0.6; }
      100% { transform: scale(1) rotate(0deg); opacity: 1; }
    }

    @keyframes mandalaGrid {
      0% { transform: scale(0.5); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes fadeOut {
      0% { opacity: 1; }
      100% { opacity: 0; }
    }

    .mandala-circles {
      background: radial-gradient(circle at center, #ffe4e1, #f9f9f9);
      animation: mandalaCircles 4s ease-out forwards;
    }

    .mandala-stars {
      background: radial-gradient(circle at center, #fffac8, #f0f8ff);
      animation: mandalaStars 4s ease-out forwards;
    }

    .mandala-petals {
      background: radial-gradient(circle at center, #f0fff0, #fff0f5);
      animation: mandalaPetals 4s ease-out forwards;
    }

    .mandala-grid {
      background: linear-gradient(135deg, #fff0f5 0%, #f0fff0 100%);
      animation: mandalaGrid 4s ease-out forwards;
    }

    /* Quote Card */
    .quote-card {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 90%;
      width: 600px;
      padding: 25px;
      background: rgba(255, 255, 255, 0.95);
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      display: none;
      text-align: center;
      font-size: 1.1em;
      transition: opacity 0.5s ease;
      z-index: 999;
      animation: slideIn 0.5s ease-out;
    }

    .quote-card.show {
      display: block;
      opacity: 1;
    }

    .quote-card.hiding {
      opacity: 0;
    }

    @keyframes slideIn {
      0% { transform: translate(-50%, -60%); opacity: 0; }
      100% { transform: translate(-50%, -50%); opacity: 1; }
    }

    .pali-text {
      font-size: 1.2em;
      line-height: 1.6;
      margin-bottom: 15px;
      color: #2c3e50;
    }

    .english-reading {
      font-size: 0.9em;
      color: #555;
      font-style: italic;
      margin: 15px 0;
      opacity: 0.85;
      line-height: 1.5;
    }

    .quote-source {
      font-size: 0.9em;
      margin-top: 12px;
      color: #888;
    }

    .quote-image {
      margin: 20px 0;
      max-width: 100%;
      height: auto;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .quote-image:hover {
      transform: scale(1.02);
    }

    .quote-actions {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }

    .action-btn {
      padding: 10px 20px;
      border-radius: 25px;
      font-size: 0.9em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      background: #f7e7a0;
      color: #333;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    .action-btn:hover {
      background: #edd279;
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
    }

    .action-btn:active {
      transform: translateY(1px);
    }

    /* Centered Sun Button (Generate Button) */
    .generate-container {
      position: fixed;
      top: 80%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 997;
    }

    .generate-btn {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: linear-gradient(135deg, #f7e7a0 0%, #edd279 100%);
      color: #333;
      font-size: 2.2em;
      border: none;
      cursor: pointer;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      display: flex;
      justify-content: center;
      align-items: center;
      animation: pulse 3s infinite ease-in-out;
    }

    .generate-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    }

    @keyframes pulse {
      0% { box-shadow: 0 5px 15px rgba(247, 231, 160, 0.3); }
      50% { box-shadow: 0 5px 25px rgba(247, 231, 160, 0.6); }
      100% { box-shadow: 0 5px 15px rgba(247, 231, 160, 0.3); }
    }

    .ko-fi-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      display: inline-block;
      background: #f7e7a0;
      border: none;
      padding: 10px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      color: #333;
      text-decoration: none;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .ko-fi-btn:hover {
      background: #edd279;
      transform: scale(1.05);
    }

    /* Blessing of the Day - FIXED */
    .blessing-of-day {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.95);
      padding: 15px 20px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      z-index: 1001;
      display: block;
      animation: fadeIn 0.5s ease-out;
      max-width: 90%;
      text-align: center;
    }

    .blessing-of-day.show {
      display: block;
      opacity: 1;
    }

    .blessing-of-day .blessing-text {
      font-size: 1em;
      color: #8b0000;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .blessing-of-day .english-reading {
      font-size: 0.85em;
      color: #555;
      font-style: italic;
      margin: 0;
    }

    /* Stats Counter */
    .stats-counter {
      position: fixed;
      bottom: 120px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.9);
      padding: 10px 20px;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
      z-index: 998;
      text-align: center;
      font-size: 0.9em;
      color: #666;
    }

    .stats-counter .stat-item {
      display: inline-block;
      margin: 0 10px;
      font-weight: bold;
    }

    .stats-counter .stat-number {
      color: #8b0000;
      font-size: 1.1em;
    }

    /* Quick Actions Panel */
    .quick-actions {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 998;
    }

    .quick-action-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.9);
      border: none;
      font-size: 1.5em;
      cursor: pointer;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .quick-action-btn:hover {
      transform: scale(1.1);
      background: #f7e7a0;
    }

    /* Progress Ring */
    .progress-ring {
      position: fixed;
      bottom: 20px;
      left: 20px;
      width: 60px;
      height: 60px;
      z-index: 998;
    }

    .progress-ring svg {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .progress-ring circle {
      fill: none;
      stroke-width: 4;
    }

    .progress-ring .bg {
      stroke: rgba(255, 255, 255, 0.3);
    }

    .progress-ring .progress {
      stroke: #f7e7a0;
      stroke-linecap: round;
      transition: stroke-dashoffset 0.5s ease;
    }

    .progress-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 0.8em;
      font-weight: bold;
      color: #333;
    }

/* Creator Section - FIXED */
.creator-section {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(255, 255, 255, 0.85);
  padding: 8px 15px; /* Reduced padding */
  text-align: center;
  font-size: 0.8em; /* Smaller font */
  z-index: 996; /* Lower z-index */
  border-top: 1px solid #ccc;
  height: 35px; /* Fixed height */
  display: flex;
  align-items: center;
  justify-content: center;
}

.creator-section a {
  color: #8b0000;
  text-decoration: none;
  font-weight: bold;
}

.creator-section a:hover {
  text-decoration: underline;
}

/* Adjust other elements to avoid footer overlap */
.stats-counter {
  position: fixed;
  bottom: 50px; /* Moved up from footer */
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255, 255, 255, 0.9);
  padding: 10px 20px;
  border-radius: 10px;
  box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
  z-index: 998;
  text-align: center;
  font-size: 0.9em;
  color: #666;
}

.quick-actions {
  position: fixed;
  bottom: 50px; /* Moved up from footer */
  right: 20px;
  display: flex;
  flex-direction: column;
  gap: 10px;
  z-index: 998;
}

.progress-ring {
  position: fixed;
  bottom: 50px; /* Moved up from footer */
  left: 20px;
  width: 60px;
  height: 60px;
  z-index: 998;
}

.notification {
  position: fixed;
  bottom: 80px; /* Moved up from footer */
  left: 50%;
  transform: translateX(-50%);
  background: rgba(255, 255, 255, 0.9);
  padding: 10px 20px;
  border-radius: 10px;
  box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
  z-index: 1000;
  display: none;
  font-size: 0.9em;
  color: #333;
  animation: fadeInOut 3s ease-in-out forwards;
}

/* Generate Button - Adjusted */
.generate-container {
  position: fixed;
  top: 70%; /* Moved up slightly */
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 997;
}

/* Mobile Adjustments - UPDATED */
@media (max-width: 600px) {
  .creator-section {
    font-size: 0.7em;
    padding: 5px 10px;
    height: 30px;
  }

  .stats-counter {
    bottom: 40px; /* Adjusted for mobile */
    width: 90%;
    font-size: 0.8em;
    padding: 8px 15px;
  }

  .stats-counter .stat-item {
    margin: 0 5px;
    display: block;
  }

  .quick-actions {
    bottom: 40px; /* Adjusted for mobile */
    right: 10px;
  }

  .quick-action-btn {
    width: 45px;
    height: 45px;
    font-size: 1.3em;
  }

  .progress-ring {
    bottom: 40px; /* Adjusted for mobile */
    left: 10px;
    width: 50px;
    height: 50px;
  }

  .notification {
    bottom: 70px; /* Adjusted for mobile */
    width: 90%;
    font-size: 0.8em;
  }

  .generate-container {
    top: 65%; /* Moved up more on mobile */
  }

  /* Add bottom padding to body to prevent content cutoff */
  body {
    padding-bottom: 40px;
  }
}

/* Alternative: Hide footer on small screens */
@media (max-width: 480px) {
  .creator-section {
    display: none; /* Hide footer on very small screens */
  }
  
  .stats-counter,
  .quick-actions,
  .progress-ring,
  .notification {
    bottom: 20px; /* Move back to original positions */
  }
  
  body {
    padding-bottom: 0;
  }
}


    /* Controls */
    .controls {
      position: fixed;
      top: 20px;
      left: 20px;
      right: 20px;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      z-index: 998;
      flex-direction: row;
      align-items: center;
    }

    .theme-selector, .source-filter {
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ddd;
      font-size: 0.9em;
      min-width: 150px;
      background-color: rgba(255, 255, 255, 0.9);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
    }

    .theme-selector:hover, .source-filter:hover {
      border-color: #f7e7a0;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
    }

    /* Notification */
    .notification {
      position: fixed;
      bottom: 50px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.9);
      padding: 10px 20px;
      border-radius: 10px;
      box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
      z-index: 1000;
      display: none;
      font-size: 0.9em;
      color: #333;
      animation: fadeInOut 3s ease-in-out forwards;
    }

    @keyframes fadeInOut {
      0% { opacity: 0; transform: translate(-50%, 20px); }
      10% { opacity: 1; transform: translate(-50%, 0); }
      90% { opacity: 1; transform: translate(-50%, 0); }
      100% { opacity: 0; transform: translate(-50%, 20px); }
    }

    @keyframes fadeIn {
      0% { opacity: 0; }
      100% { opacity: 1; }
    }

    /* Mobile Adjustments */
    @media (max-width: 600px) {
      .controls {
        flex-direction: column;
        justify-content: center;
        gap: 8px;
      }

      .theme-selector, .source-filter {
        width: 90%;
        min-width: auto;
      }

      .generate-container {
        top: 75%;
      }

      .ko-fi-btn {
        right: 10px;
        top: 10px;
        font-size: 0.8em;
        padding: 8px 12px;
      }

      .blessing-of-day {
        top: 120px;
        width: 95%;
        font-size: 0.9em;
        padding: 10px 15px;
      }

      .stats-counter {
        bottom: 100px;
        width: 90%;
        font-size: 0.8em;
        padding: 8px 15px;
      }

      .stats-counter .stat-item {
        margin: 0 5px;
        display: block;
      }

      .quick-actions {
        bottom: 10px;
        right: 10px;
      }

      .quick-action-btn {
        width: 45px;
        height: 45px;
        font-size: 1.3em;
      }

      .progress-ring {
        bottom: 10px;
        left: 10px;
        width: 50px;
        height: 50px;
      }

      .quote-card {
        width: 95%;
        padding: 15px;
        font-size: 1em;
      }

      .pali-text {
        font-size: 1.1em;
      }

      .english-reading {
        font-size: 0.85em;
      }

      .action-btn {
        padding: 8px 16px;
        font-size: 0.8em;
      }

      .mandala {
        z-index: 980;
      }
    }
  </style>
</head>
<body>
  <!-- Ko-Fi Support Button -->
  <a href="https://linktr.ee/ThanttEzekiel" class="ko-fi-btn" target="_blank" aria-label="Support the creator">☕ Support Me</a>

  <!-- Controls -->
  <div class="controls">
    <select class="theme-selector" id="themeSelector" aria-label="Select a temple theme">
      <option value="theme-wat-pra-kew">Wat Pra Kew</option>
      <option value="theme-wat-po">Wat Po</option>
      <option value="theme-wat-benchamabophit">Wat Benchamabophit</option>
      <option value="theme-wat-phra-singh">Wat Phra Singh</option>
      <option value="theme-wat-phnom-penh">Wat Phnom Penh</option>
      <option value="theme-wat-suthat">Wat Suthat</option>
      <option value="theme-wat-arun">Wat Arun</option>
      <option value="theme-wat-chedi-luang">Wat Chedi Luang</option>
      <option value="theme-wat-traimit">Wat Traimit</option>
    </select>

    <select class="source-filter" id="sourceFilter" aria-label="Filter by source">
      <option value="all">All Sources</option>
      <option value="Buddhism">Buddhism</option>
    </select>

    <select class="source-filter" id="ttsLanguage" aria-label="Select TTS language">
      <option value="th-TH">Pali (Thai)</option>
      <option value="en-US">English</option>
    </select>
  </div>

  <!-- Blessing of the Day -->
  <div class="blessing-of-day" id="blessingOfDay">
    <div class="blessing-text" id="blessingOfDayText">Daily Blessing Loading...</div>
    <div class="english-reading" id="blessingOfDayEnglish">Please wait...</div>
  </div>

  <!-- Generate Button (Sun Button Centered) -->
  <div class="generate-container" role="button" tabindex="0" aria-label="Generate a new blessing">
    <button class="generate-btn" id="starButton" aria-label="Generate a new blessing">☀️</button>
  </div>

  <!-- Stats Counter -->
  <div class="stats-counter" id="statsCounter">
    <span class="stat-item">🙏 Blessings Read: <span class="stat-number" id="blessingsCount">0</span></span>
    <span class="stat-item">❤️ Favorites: <span class="stat-number" id="favoritesCount">0</span></span>
    <span class="stat-item">📅 Days Active: <span class="stat-number" id="daysActive">1</span></span>
  </div>

  <!-- Progress Ring -->
  <div class="progress-ring" id="progressRing">
    <svg>
      <circle class="bg" cx="30" cy="30" r="26"></circle>
      <circle class="progress" cx="30" cy="30" r="26" stroke-dasharray="163.36" stroke-dashoffset="163.36"></circle>
    </svg>
    <div class="progress-text" id="progressText">0%</div>
  </div>

  <!-- Quick Actions Panel -->
  <div class="quick-actions">
    <button class="quick-action-btn" id="randomBlessingBtn" title="Random Blessing">🎲</button>
    <button class="quick-action-btn" id="favoritesBtn" title="View Favorites">❤️</button>
    <button class="quick-action-btn" id="settingsBtn" title="Settings">⚙️</button>
  </div>

  <!-- Mandala Animation -->
  <div class="mandala" id="mandala" aria-label="Mandala Animation"></div>

  <!-- Quote Card -->
  <div class="quote-card" id="quoteCard" aria-label="Blessing quote card" role="region">
    <div class="quote-text pali-text" id="quoteText"></div>
    <div class="english-reading" id="englishReading"></div>
    <div class="quote-source" id="quoteSource"></div>
    <img class="quote-image" id="quoteImage" alt="Thai Temple" />
    <div class="quote-actions">
      <button class="action-btn blessing-btn" id="blessingBtn" aria-label="Send a blessing">🙏🏻 Send Blessing</button>
      <button class="action-btn secondary-btn" id="playBtn" aria-label="Listen to the blessing">🔊 Listen</button>
      <button class="action-btn secondary-btn" id="favoriteBtn" aria-label="Save this blessing">❤️ Save</button>
      <button class="action-btn secondary-btn" id="shareBtn" aria-label="Share this blessing">📤 Share</button>
      <button class="action-btn secondary-btn" id="copyBtn" aria-label="Copy this blessing">📋 Copy</button>
      <button class="action-btn secondary-btn" id="closeCard" aria-label="Close this card">✕ Close</button>
    </div>
  </div>

  <!-- White Splash Effect -->
  <div class="white-splash" id="whiteSplash"></div>

  <!-- Creator Section -->
  <div class="creator-section" id="creatorSection">
    <p>Created by <a href="https://pigletpeakkung.github.io/Thannxai/" target="_blank">Thanatsitt Santisamranwilai</a> 🙏 | 
    <a href="https://unsplash.com" target="_blank">Images from Unsplash</a></p>
  </div>

  <!-- Notifications -->
  <div class="notification" id="ttsStatus"></div>
  <div class="notification" id="notification"></div>

  <script>
    // Random Thai Temple Images (13 verified working URLs)
    const templeImages = [
      "https://images.unsplash.com/photo-1528181304800-259b08848526?w=800&q=80",
      "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&q=80",
      "https://images.unsplash.com/photo-1563906267088-b029e7101114?w=800&q=80",
      "https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=800&q=80",
      "https://images.unsplash.com/photo-1571896349842-33c89424de2d?w=800&q=80",
      "https://images.unsplash.com/photo-1566844537468-2860d607fdfe?w=800&q=80",
      "https://images.unsplash.com/photo-1605640840605-14ac1855827b?w=800&q=80",
      "https://images.unsplash.com/photo-1552465011-b4e21bf6e79a?w=800&q=80",
      "https://images.pexels.com/photos/1007025/pexels-photo-1007025.jpeg?w=800&h=600&fit=crop",
      "https://images.pexels.com/photos/1386604/pexels-photo-1386604.jpeg?w=800&h=600&fit=crop",
      "https://images.pexels.com/photos/1007024/pexels-photo-1007024.jpeg?w=800&h=600&fit=crop",
      "https://images.pexels.com/photos/1386595/pexels-photo-1386595.jpeg?w=800&h=600&fit=crop",
      "https://via.placeholder.com/600x400/f7e7a0/333333?text=Thai+Temple+Blessing"
    ];

    // Daily Blessings
    let blessingsOfDay = [
      {
        id: 654,
        thai: "จงใช้ชีวิตในปัจจุบันอย่างมีสติและปัญญา",
        english: "Live in the present moment wisely.",
        source: "S.N. Goenka"
      },
      {
        id: 655,
        thai: "วิปัสสนาหมายถึง 'การมองเห็นสิ่งต่างๆ ตามความเป็นจริง' ไม่ใช่ตามที่มันดูเหมือนจะเป็น",
        english: "Vipassana means 'to see things as they really are', not as they appear to be.",
        source: "S.N. Goenka"
      },
      {
        id: 656,
        thai: "ทุกความรู้สึกเกิดขึ้นเพื่อดับไป ไม่มีสิ่งใดถาวร นี่คือกฎแห่งอนิจจัง",
        english: "Every sensation arises to pass away. Nothing is eternal. This is the law of impermanence.",
        source: "S.N. Goenka"
      },
      {
        id: 657,
        thai: "รากเหง้าของความทุกข์คือความอยากและความเกลียดชัง กำจัดมันเสีย และคุณจะกำจัดความทุกข์ได้",
        english: "The root of suffering is craving and aversion. Eradicate them, and you eradicate suffering.",
        source: "S.N. Goenka"
      },
      {
        id: 658,
        thai: "ทำงานอย่างขยันหมั่นเพียร ทำงานอย่างอดทน ทำงานอย่างต่อเนื่อง คุณจะต้องประสบความสำเร็จแน่นอน",
        english: "Work diligently. Work patiently. Work persistently. You are bound to be successful.",
        source: "S.N. Goenka"
      },
      {
        id: 659,
        thai: "ธรรมะไม่ใช่ปรัชญา ธรรมะเป็นวิธีปฏิบัติเพื่อใช้ชีวิตอย่างมีความสุข",
        english: "Dhamma is not a philosophy. Dhamma is a practical way of living a happy life.",
        source: "S.N. Goenka"
      },
      {
        id: 660,
        thai: "เมื่อคุณนั่งสมาธิ อย่าคาดหวังอะไร อย่าปรารถนาอะไร อย่าปฏิเสธอะไร",
        english: "When you meditate, don't expect anything, don't crave for anything, don't reject anything.",
        source: "S.N. Goenka"
      },
      {
        id: 661,
        thai: "จักรวาลทั้งหมดเป็นเพียงการสั่นสะเทือน เกิดขึ้นและดับไป",
        english: "The entire universe is nothing but vibration, arising and passing.",
        source: "S.N. Goenka"
      },
      {
        id: 662,
        thai: "ลมหายใจของคุณคือสะพานเชื่อมระหว่างจิตสำนึกและจิตไร้สำนึก",
        english: "Your breath is the bridge between the conscious and unconscious mind.",
        source: "S.N. Goenka"
      },
      {
        id: 663,
        thai: "การหลุดพ้นเป็นไปได้ที่นี่และเดี๋ยวนี้ ไม่ใช่ในสวรรค์ที่จินตนาการขึ้น",
        english: "Liberation is possible here and now, not in some imaginary heaven.",
        source: "S.N. Goenka"
      },
      {
        id: 664,
        thai: "จิตที่บริสุทธิ์เต็มไปด้วยความรัก—ความรักต่อทุกสรรพสิ่งโดยไม่เลือกปฏิบัติ",
        english: "A pure mind is full of love—love for all beings without discrimination.",
        source: "S.N. Goenka"
      },
      {
        id: 665,
        thai: "จิตใจเหมือนเด็กที่ถูกตามใจ—ยิ่งคุณตามใจมันมากเท่าไหร่ มันยิ่งเรียกร้องมากขึ้นเท่านั้น",
        english: "The mind is like a spoiled child—the more you pamper it, the more it demands.",
        source: "S.N. Goenka"
      }
    ];

    // Passages with complete English translations
    const passages = [
      {
        id: 1,
        text: "พุทธัง สะระณัง คัจฉามิ\nธัมมัง สะระณัง คัจฉามิ\nสังฆัง สะระณัง คัจฉามิ",
        englishReading: "I go for refuge to the Buddha,\nI go for refuge to the Dhamma,\nI go for refuge to the Sangha.",
        source: "Buddhism",
        theme: "theme-wat-pra-kew"
      },
      {
        id: 2,
        text: "พุทธะบูชา มหาเตชะวันโต\nธัมมะบูชา มหาปัญโญ\nสังฆะบูชา มหาโภคะวาโห\nติโลกะนาถัง อภิปูชะยามิ",
        englishReading: "To honor the Buddha, the great seer;\nTo honor the Dhamma, the great wisdom;\nTo honor the Sangha, the great possessor of treasure;\nI bow to the Buddha, the Teacher of the three worlds.",
        source: "Buddhism",
        theme: "theme-wat-po"
      },
      {
        id: 3,
        text: "พุทธัง ชีวิตัง ยาวะ นิพพานัง สะระณัง คัจฉามิ\nอิติปิ โส ภะคะวา อะระหัง สัมมาสัมพุทโธ\nวิชชาจะระณะสัมปันโน สุคะโต โลกะวิทู อะนุตตะโร\nปูริสะทัมมสาระถิ สัตถา เทวะมะนุสสานัง พุทโธ ภะคะวาติ สะวากขาโต ภะคะวะตา ธัมโม สันทิฏฐิโก อะกาลิโก เอหิปัสสิโก โอปะนะยิโก ปัจจัตตัง เวทิตัพโพ วิญญูหิติ",
        englishReading: "I go for refuge to the Buddha, the living one, until Nibbana.\nSuch is the Buddha, the Arahant, the Fully Enlightened One,\nEndowed with knowledge and vision, the Worthy One, the Knower of the world,\nUnsurpassed, the Teacher of devas and humans, the Buddha, the Exalted One.\nThe Dhamma taught by the Buddha is to be seen here and now, timeless, inviting, leading to realization, and understood by the wise.",
        source: "Buddhism",
        theme: "theme-wat-benchamabophit"
      },
      {
        id: 4,
        text: "ธัมมัง ชีวิตัง ยาวะ นิพพานัง สะระณัง คัจฉามิ\nสวากขาโต ภะคะวะตา ธัมโม สันทิฏฐิโก อะกาลิโก เอหิปัสสิโก โอปะนะยิโก ปัจจัตตัง เวทิตัพโพ วิญญูฮีติ",
        englishReading: "I go for refuge to the Dhamma, the living one, until Nibbana.\nThe Dhamma taught by the Buddha is to be seen here and now, timeless, inviting all to come and see, leading to self-discovery, for the wise to realize.",
        source: "Buddhism",
        theme: "theme-wat-phra-singh"
      },
      {
        id: 5,
        text: "สังฆัง ชีวิตัง ยาวะ นิพพานัง สะระณัง คัจฉามิ\nสุปะฏิปันโน ภะคะวะโต สาวะกะสังโฆ\nอุชุปะฏิปันโน ภะคะวะโต สาวะกะสังโฆ\nญายะปะฏิปันโน ภะคะวะโต สาวะกะสังโฆ\nสามีจิปะฏิปันโน ภะคะวะโต สาวะกะสังโฆ\nยะทิทัง จัตตาริ ปุริสะยุคานิ อัฏฐะ ปุริสะปุคคะลา\nเอสะ ภะคะวะโต สาวะกะสังโฆ\nอาหุเนยโย ปาหุเนยโย ทักขิเนยโย อัญชะลีกะระณีโย\nอะนุตตะรัง ปุญญักเขตตัง โลกัสสาติ",
        englishReading: "I go for refuge to the Sangha, the living one, until Nibbana.\nThe well-taught Sangha, the well-disciplined Sangha, the ardent Sangha, the wise Sangha, the noble Sangha of the Buddha.\nThey rightly understand the four foundations of mindfulness, eightfold path, and eight great qualities. This is the noble Sangha of the Buddha, worthy to be given alms, honored, and respected as an unsurpassed blessing to the world.",
        source: "Buddhism",
        theme: "theme-wat-arun"
      },
       {
        id: 6,
        text: "จัตตาโร สติปัฏฐานา จัตตาโร อิทธิปาทา สัมมาอาชีโว",
        englishReading: "The four frames of reference, the four great powers, and the right livelihood.",
        source: "Buddhism",
        theme: "theme-wat-chedi-luang"
      },
      {
        id: 7,
        text: "มะณีจินดา ปิยังปัญจะธานัง ยะสังทาสา ทาสี โกมัง ปะสันติ เสน่หัง มาตาปุตตังวะโอระสัง สัพเพชะนา พะหูชะนา\nสัพเพปุริสา พะหูปริสา สัพเพอิตถี พะหูอิตถี สารังเจนัง ภะวันตุเม",
        englishReading: "May all beings and creatures who are seen and unseen, who are here or elsewhere, near or far, small or large, young or old—may all beings dwell in peace. May mothers and children, humans, animals, and all beings be free from suffering.",
        source: "Buddhism (General Blessing)",
        theme: "theme-wat-traimit"
      },
      {
        id: 8,
        text: "เวทาสากุ กุสาทาเว ทายะสาตะ ตะสายะทา สาสาทิกุ กุทิสาสา กุตะกุภู ภูกุตะกุ",
        englishReading: "Let all beings in the sky, on land, and in water who are seen and unseen, who are present or elsewhere, who are large or small, who have been born or not yet born be free from suffering and live in happiness.",
        source: "Buddhism (General Blessing)",
        theme: "theme-wat-traimit"
      },
      {
        id: 9,
        text: "นะโมพุทธายะ นะมะพะทะ นาสังสิโม จะอะพะคะ อิกะมะภะ ทะทะชะสิ กะระมะถะ จะภะกะสะ นาสังสิโม นะเปื้อน พุทธาเฟือนหัวใจ โมหลงใหล ยะวังเวงสูญเปล่า นะจังงัง โมจังงัง พุทปิดทาง ระปิดหู",
        englishReading: "Namo Buddhaya, Namo Dhamma, Namo Sangha. I take refuge in the Buddha, the Dhamma, the Sangha. May all beings, seen and unseen, be free from suffering and dwell in peace. May the Buddha's compassion reach into the hearts of all, filling the void of suffering with love and light.",
        source: "Buddhism (General Blessing)",
        theme: "theme-wat-traimit"
      },
      {
        id: 10,
        text: "อักโขหะมัสสะมิ โลกัสสะ อิติปาระมิตาติงสา อิติสัพพัญญูมาคะตา อิติ โพธิมะนุปัตโต",
        englishReading: "I take refuge in the Buddha, the All-Compassionate, the Teacher of the World, the All-Seeing, the All-Knowing, the One who leads to Enlightenment.",
        source: "Buddhism",
        theme: "theme-wat-pra-kew"
      },
      {
        id: 11,
        text: "อิติปิโส จะ เต นะโม อะระหัง ลาโภ พุทโธ ลาภัง นะชาลีติ",
        englishReading: "Such is the Buddha, the Arahant, the Fully Enlightened One, the Worthy of Offerings, the Teacher of the World.",
        source: "Buddhism",
        theme: "theme-wat-benchamabophit"
      },
      {
        id: 12,
        text: "นะมะพะทะ สัพเพ ชะนา พหู ชะนา ราชาปุริโส อิตถิโยมาพัง เอหิ จิตตัง ปิยัง มะมะ",
        englishReading: "Namo Dhamma, all beings, many beings, kings and commoners, may all come with a loving heart, may all be well.",
        source: "Buddhism (General Blessing)",
        theme: "theme-wat-benchamabophit"
      },
      {
        id: 13,
        text: "เอหิ มาเร โส มามา อาคัจเฉยยะ อาคัจฉาหิ",
        englishReading: "Come, O beings, with a loving heart, come with a kind mind, come with compassion, come with peace.",
        source: "Buddhism (General Blessing)",
        theme: "theme-wat-suthat"
      },
      {
        id: 14,
        text: "วันทามิ พุทธัง สัพพะเมโทสัง ขะมะถะเม ภันเต",
        englishReading: "I bow to the Buddha, the All-Compassionate, the All-Seeing, the Worthy One.",
        source: "Buddhism",
        theme: "theme-wat-phnom-penh"
      },
      {
        id: 15,
        text: "วันทามิ ธัมมัง สัพพะเมโทสัง ขะมะถะเม ภันเต",
        englishReading: "I bow to the Dhamma, the All-Compassionate, the All-Seeing, the Worthy One.",
        source: "Buddhism",
        theme: "theme-wat-suthat"
      },
      {
        id: 16,
        text: "วันทามิ สังฆัง สัพพะเมโทสัง ขะมะถะเม ภันเต",
        englishReading: "I bow to the Sangha, the All-Compassionate, the All-Seeing, the Worthy One.",
        source: "Buddhism",
        theme: "theme-wat-traimit"
      },
      {
        id: 17,
        text: "อิ. อิฏโฐ สัพพัญญุตัญญานัง",
        englishReading: "I bow to the Buddha, the All-Knowing, the All-Seeing.",
        source: "Buddhism",
        theme: "theme-wat-traimit"
      },
      {
        id: 18,
        text: "อิจฉันโต อาสะวักขะยัง",
        englishReading: "I bow to the Buddha, the One who is Unshakable, Unmoved by suffering.",
        source: "Buddhism",
        theme: "theme-wat-phra-singh"
      },
      {
        id: 19,
        text: "อิฏฐัง ธัมมัง อะนุปปัตโต",
        englishReading: "I bow to the Dhamma, the Teaching that leads to Enlightenment.",
        source: "Buddhism",
        theme: "theme-wat-traimit"
      },
      {
        id: 20,
        text: "อิติปิโส ภะคะวา อะระหัง สัมมาสัมพุทโธ วิชชาจะระณะสัมปันโน สุคะโต โลกะวิทู อะนุตตะโร ปุริสะทัมมะสาระถิ สัตถา เทวะมะนุสสานัง พุทโธ ภะคะวาติ สะวากขาโต ภะคะวะตา ธัมโม สันทิฏฐิโก อะกาลิโก เอหิปัสสิโก โอปะนะยิโก ปัจจัตตัง เวทิตัพโพ วิญญูหิติ",
        englishReading: "Itipiso bhagavā arahā samma sambuddho vijjācaraṇasampanno sukhito lokavitu anuttaro purisadammasarathi satthā devamanussānaṃ buddho bhagavāti savaṅkhato bhagavatā dhammo santikiko ākāliko ehipassiko opaṇīyiko paccattaṃ vetithabbo viññūhiti.",
        source: "Buddhism",
        theme: "theme-wat-pra-kew"
      },
      {
        id: 21,
        text: "อิทธิมันตัง นะมามิหัง",
        englishReading: "I bow to the Buddha, the One of Great Power.",
        source: "Buddhism",
        theme: "theme-wat-pra-kew"
      },
      {
        id: 22,
        text: "ติ. ติณโณ โย วัฏฏะทุกขัมหา",
        englishReading: "I bow to the Buddha, the One who sees the cycle of suffering.",
        source: "Buddhism",
        theme: "theme-wat-arun"
      },
      {
        id: 23,
        text: "ติณณัง โลกานะมุตตะโม",
        englishReading: "I bow to the Buddha, the Teacher of the World.",
        source: "Buddhism",
        theme: "theme-wat-traimit"
      },
      {
        id: 24,
        text: "ติสโส ภูมี อะติกกันโต",
        englishReading: "I bow to the Buddha, the Unsurpassed One, the One who has crossed all obstacles.",
        source: "Buddhism",
        theme: "theme-wat-phra-singh"
      },
      {
        id: 25,
        text: "ติณณะโอฆัง นะมามิหัง",
        englishReading: "I bow to the Buddha, the One who has conquered all defilements.",
        source: "Buddhism",
        theme: "theme-wat-chedi-luang"
      },
      {
        id: 26,
        text: "ปิ. ปิโย เทวะมะนุสสานัง",
        englishReading: "I bow to the Buddha, beloved by devas and humans.",
        source: "Buddhism",
        theme: "theme-wat-chedi-luang"
      },
      {
        id: 27,
        text: "ปิโยพฺรหฺมานะมุตตะโม",
        englishReading: "I bow to the Buddha, beloved by the Brahma, the Supreme Teacher.",
        source: "Buddhism",
        theme: "theme-wat-traimit"
      },
      {
        id: 28,
        text: "ปิโย นาคะสุปัณณานัง",
        englishReading: "I bow to the Buddha, the One who is the Light of the World.",
        source: "Buddhism",
        theme: "theme-wat-phra-singh"
      },
      {
        id: 29,
        text: "ปิณินทฺริยัง นะมามิหัง",
        englishReading: "I bow to the Buddha, the One who is praised by the world.",
        source: "Buddhism",
        theme: "theme-wat-suthat"
      },
      {
        id: 30,
        text: "สัตถา เทวะมะนุสสานัง พุทโธ ภะคะวาติ สะวากขาโต ภะคะวะตา ธัมโม สันทิฏฐิโก อะกาลิโก เอหิปัสสิโก โอปะนะยิโก ปัจจัตตัง เวทิตัพโพ วิญญูหิติ",
        englishReading: "The Buddha is the Teacher of devas and humans. The Dhamma is to be seen here and now, timeless, inviting, leading to self-realization, and understood by the wise.",
        source: "Buddhism",
        theme: "theme-wat-pra-kew"
      },
      {
        id: 31,
        text: "สวากขาโต ภะคะวะตา ธัมโม สันทิฏฐิโก อะกาลิโก เอหิปัสสิโก โอปะนะยิโก ปัจจัตตัง เวทิตัพโพ วิญญูหิติ",
        englishReading: "The Dhamma taught by the Buddha is to be seen here and now, timeless, inviting all to come and see, leading to self-discovery, for the wise to realize.",
        source: "Buddhism",
        theme: "theme-wat-phra-singh"
      },
      {
        id: 32,
        text: "สุปะฏิปันโน ภะคะวะโต สาวะกะสังโฆ",
        englishReading: "The well-taught Sangha of the Buddha.",
        source: "Buddhism",
        theme: "theme-wat-arun"
      },
      {
        id: 33,
        text: "อุชุปะฏิปันโน ภะคะวะโต สาวะกะสังโฆ",
        englishReading: "The well-disciplined Sangha of the Buddha.",
        source: "Buddhism",
        theme: "theme-wat-traimit"
      },
      {
        id: 34,
        text: "ญายะปะฏิปันโน ภะคะวะโต สาวะกะสังโฆ",
        englishReading: "The ardent Sangha of the Buddha.",
        source: "Buddhism",
        theme: "theme-wat-phnom-penh"
      },
      {
        id: 35,
        text: "สามีจิปะฏิปันโน ภะคะวะโต สาวะกะสังโฆ",
        englishReading: "The wise Sangha of the Buddha.",
        source: "Buddhism",
        theme: "theme-wat-suthat"
      },
      {
        id: 36,
        text: "ยะทิทัง จัตตาริ ปุริสะยุคานิ อัฏฐะ ปุริสะปุคคะลา",
        englishReading: "They rightly understand the four foundations of mindfulness and the eight great qualities.",
        source: "Buddhism",
        theme: "theme-wat-benchamabophit"
      },
      {
        id: 37,
        text: "เอสะ ภะคะวะโต สาวะกะสังโฆ",
        englishReading: "This is the noble Sangha of the Buddha.",
        source: "Buddhism",
        theme: "theme-wat-phra-singh"
      },
      {
        id: 38,
        text: "อาหุเนยโย ปาหุเนยโย ทักขิเนยโย อัญชะลีกะระณีโย",
        englishReading: "Worthy of offerings, alms, and honor, the One who is the field of merit.",
        source: "Buddhism",
        theme: "theme-wat-pra-kew"
      },
      {
        id: 39,
        text: "อะนุตตะรัง ปุญญักเขตตัง โลกัสสาติ",
        englishReading: "Unsurpassed as a field of merit for the world.",
        source: "Buddhism",
        theme: "theme-wat-traimit"
      },
      {
        id: 40,
        text: "สัพเพชะนา พะหูชะนา สัพเพปุริสา พะหูปริสา สัพเพอิตถี พะหูอิตถี สารังเจนัง ภะวันตุเม",
        englishReading: "May all beings, all creatures, all sentient beings, and all who are dear to you be free from suffering, free from pain, and dwell in peace.",
        source: "Buddhism (General Blessing)",
        theme: "theme-wat-phra-singh"
      }
    ];
let usedPassages = [];
    let favorites = [];
    let quotesRead = 0;
    let currentQuote = null;
    let isGenerating = false;
    let ttsDisabled = false;
    let autoHideTimer = null;
    let daysActive = 1;

    // Validate localStorage
    try {
      usedPassages = JSON.parse(localStorage.getItem('usedPassages')) || [];
      favorites = JSON.parse(localStorage.getItem('favorites')) || [];
      quotesRead = parseInt(localStorage.getItem('quotesRead')) || 0;
      daysActive = parseInt(localStorage.getItem('daysActive')) || 1;
    } catch (e) {
      showNotification("Failed to load saved data. Resetting...");
      usedPassages = [];
      favorites = [];
      quotesRead = 0;
      daysActive = 1;
    }

    // Update stats display
    function updateStats() {
      document.getElementById('blessingsCount').textContent = quotesRead;
      document.getElementById('favoritesCount').textContent = favorites.length;
      document.getElementById('daysActive').textContent = daysActive;
      
      // Update progress ring
      const progress = Math.min((quotesRead / 40) * 100, 100);
      const circumference = 163.36;
      const offset = circumference - (progress / 100) * circumference;
      document.querySelector('.progress').style.strokeDashoffset = offset;
      document.getElementById('progressText').textContent = Math.round(progress) + '%';
    }

    // Track daily usage
    function trackDailyUsage() {
      const today = new Date().toISOString().split('T')[0];
      const lastVisit = localStorage.getItem('lastVisit');
      
      if (lastVisit !== today) {
        if (lastVisit) {
          daysActive++;
          localStorage.setItem('daysActive', daysActive.toString());
        }
        localStorage.setItem('lastVisit', today);
      }
    }

    // Show white splash effect
    function showWhiteSplash() {
      const splash = document.getElementById('whiteSplash');
      splash.style.display = 'block';
      splash.offsetHeight;
      splash.style.animation = 'splashEffect 0.5s ease-out forwards';
      setTimeout(() => {
        splash.style.display = 'none';
      }, 500);
    }

    // Mandala Animation
    function createMandalaAnimation(theme) {
      const mandala = document.getElementById('mandala');
      mandala.classList.remove('show');
      mandala.style.display = 'none';

      const mandalaTypes = ['mandala-circles', 'mandala-stars', 'mandala-petals', 'mandala-grid'];
      const randomType = mandalaTypes[Math.floor(Math.random() * mandalaTypes.length)];
      mandala.className = 'mandala ' + randomType;
      mandala.style.display = 'block';
      mandala.classList.add('show');

      setTimeout(() => {
        mandala.classList.remove('show');
        mandala.style.display = 'none';
      }, 5000);
    }

    // Show Notification
    function showNotification(message, timeout = 3000) {
      const notification = document.getElementById('notification');
      notification.textContent = message;
      notification.style.display = 'block';
      setTimeout(() => {
        notification.style.display = 'none';
      }, timeout);
    }

    // Show TTS Status
    function showTTSStatus(message, type = 'speaking') {
      const statusEl = document.getElementById('ttsStatus');
      statusEl.textContent = message;
      statusEl.style.display = 'block';

      if (type === 'error') {
        setTimeout(() => {
          statusEl.style.display = 'none';
        }, 3000);
      }
    }

    function hideTTSStatus() {
      const statusEl = document.getElementById('ttsStatus');
      statusEl.style.display = 'none';
    }

    // Enhanced TTS function
    function enhancedTTS(text, autoPlay = false, lang = 'th-TH') {
      if (ttsDisabled) {
        showTTSStatus("TTS is disabled due to earlier error.", 'error');
        return null;
      }
      if (!window.speechSynthesis) {
        showTTSStatus('TTS not supported. Please use a modern browser like Chrome.', 'error');
        ttsDisabled = true;
        return null;
      }

      window.speechSynthesis.cancel();

      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = lang;
      utterance.rate = 1.4;
      utterance.pitch = 0.9;
      utterance.volume = 1.0;

      function setVoice(attempts = 0) {
        const voices = window.speechSynthesis.getVoices();
        if (voices.length === 0 && attempts < 10) {
          showTTSStatus("Loading voices, please wait...", 'speaking');
          setTimeout(() => setVoice(attempts + 1), 500);
          return false;
        } else if (voices.length === 0) {
          showTTSStatus("No voices loaded. TTS unavailable.", 'error');
          ttsDisabled = true;
          return false;
        }

        const langPrefix = lang.split('-')[0];
        const maleVoice = voices.find(v => v.lang.includes(langPrefix) && v.name.toLowerCase().includes('male'));
        if (maleVoice) {
          utterance.voice = maleVoice;
        } else {
          const defaultVoice = voices.find(v => v.lang.includes(langPrefix));
          if (defaultVoice) {
            utterance.voice = defaultVoice;
          } else {
            const anyVoice = voices[0];
            if (anyVoice) {
              utterance.voice = anyVoice;
              showTTSStatus(`Using fallback voice (not ${lang === 'th-TH' ? 'Thai' : 'English'})`, 'speaking');
            } else {
              showTTSStatus("No suitable voice found for " + (lang === 'th-TH' ? 'Thai' : 'English') + ". Ensure your device/browser supports this language.", 'error');
              ttsDisabled = true;
              return false;
            }
          }
        }
        return true;
      }

      if (setVoice()) {
        showTTSStatus(`🔊 Speaking in ${lang === 'th-TH' ? 'Pali (Thai)' : 'English'}...`, 'speaking');
        if (autoPlay) window.speechSynthesis.speak(utterance);
      }

      utterance.onend = () => hideTTSStatus();
      utterance.onerror = (e) => {
        showTTSStatus(`Voice error: ${e.error}`, 'error');
        ttsDisabled = true;
      };

      return utterance;
    }

    // Display Quote with Auto-Hide
    function displayQuote(quote) {
      const quoteCard = document.getElementById('quoteCard');
      const quoteText = document.getElementById('quoteText');
      const englishReading = document.getElementById('englishReading');
      const quoteSource = document.getElementById('quoteSource');
      const quoteImage = document.getElementById('quoteImage');

      quoteText.innerHTML = `<span class="pali-text">${quote.text}</span>`;
      englishReading.textContent = quote.englishReading || "";
      quoteSource.textContent = `— ${quote.source}`;
      quoteImage.src = templeImages[Math.floor(Math.random() * templeImages.length)];
      quoteImage.alt = "Thai Temple";
      quoteImage.style.display = "block";

      document.body.className = quote.theme || "theme-wat-pra-kew";
      quoteCard.style.display = 'block';
      quoteCard.classList.remove('hiding');
      setTimeout(() => {
        quoteCard.classList.add('show');
      }, 100);

      if (autoHideTimer) clearTimeout(autoHideTimer);
      autoHideTimer = setTimeout(() => {
        quoteCard.classList.add('hiding');
        setTimeout(() => {
          quoteCard.classList.remove('show');
          quoteCard.style.display = 'none';
          quoteCard.classList.remove('hiding');
        }, 500);
      }, 30000);
    }

    function setupCardInteractions() {
      const quoteCard = document.getElementById('quoteCard');
      quoteCard.addEventListener('click', () => {
        if (autoHideTimer) {
          clearTimeout(autoHideTimer);
        }
      });
    }

    function closeQuoteCard() {
      const quoteCard = document.getElementById('quoteCard');
      quoteCard.classList.remove('show');
      quoteCard.style.display = 'none';
      if (autoHideTimer) clearTimeout(autoHideTimer);
    }

    // Generate Passage
    function generatePassage() {
      if (isGenerating) return;
      isGenerating = true;
      showWhiteSplash();

      const sourceFilter = document.getElementById('sourceFilter').value;
      let availablePassages = sourceFilter === 'all' ? passages : passages.filter(p => p.source.includes(sourceFilter));
      availablePassages = availablePassages.filter(p => !usedPassages.includes(p.id));

      if (availablePassages.length === 0) {
        usedPassages = [];
        availablePassages = sourceFilter === 'all' ? passages : passages.filter(p => p.source.includes(sourceFilter));
      }

      if (availablePassages.length === 0) {
        showNotification("No more blessings available in this category.");
        isGenerating = false;
        return;
      }

      const randomPassage = availablePassages[Math.floor(Math.random() * availablePassages.length)];
      usedPassages.push(randomPassage.id);
      localStorage.setItem('usedPassages', JSON.stringify(usedPassages));
      quotesRead++;
      localStorage.setItem('quotesRead', quotesRead.toString());

      currentQuote = randomPassage;
      displayQuote(randomPassage);
      createMandalaAnimation(document.body.className);
      enhancedTTS(randomPassage.text, true, document.getElementById('ttsLanguage').value);
      updateStats();
      isGenerating = false;
    }

    // Blessing of the Day - FIXED
    function updateBlessingOfDay() {
      const today = new Date().toISOString().split('T')[0];
      const lastBlessing = localStorage.getItem('lastBlessingOfDay');
      const blessingOfDayEl = document.getElementById('blessingOfDay');
      const blessingOfDayText = document.getElementById('blessingOfDayText');
      const blessingOfDayEnglish = document.getElementById('blessingOfDayEnglish');

      const randomBlessing = blessingsOfDay[Math.floor(Math.random() * blessingsOfDay.length)];
      blessingOfDayText.textContent = `Daily Blessing: "${randomBlessing.thai}"`;
      blessingOfDayEnglish.textContent = `${randomBlessing.english} — ${randomBlessing.source}`;
      
      blessingOfDayEl.style.display = 'block';
      blessingOfDayEl.classList.add('show');
      
      localStorage.setItem('lastBlessingOfDay', today);
    }

    // Initialize App
    window.addEventListener('DOMContentLoaded', () => {
      trackDailyUsage();
      updateBlessingOfDay();
      updateStats();
      
      document.getElementById('themeSelector').value = localStorage.getItem('selectedTheme') || 'theme-wat-pra-kew';
      document.body.className = document.getElementById('themeSelector').value;

      document.getElementById('themeSelector').addEventListener('change', (e) => {
        document.body.className = e.target.value;
        localStorage.setItem('selectedTheme', e.target.value);
      });

      document.getElementById('starButton').addEventListener('click', generatePassage);
      document.querySelector('.generate-container').addEventListener('keydown', (e) => {
        if (e.key === "Enter" || e.key === " ") generatePassage();
      });

      document.getElementById('playBtn').addEventListener('click', () => {
        if (currentQuote) enhancedTTS(currentQuote.text, true, document.getElementById('ttsLanguage').value);
      });
      
      document.getElementById('blessingBtn').addEventListener('click', () => {
        if (currentQuote) {
          createMandalaAnimation(document.body.className);
          showNotification("🙏🏻 Blessing sent!");
        }
      });
      
      document.getElementById('favoriteBtn').addEventListener('click', () => {
        if (!currentQuote) return;
        const isFavorited = favorites.some(fav => fav.id === currentQuote.id);
        if (isFavorited) {
          favorites = favorites.filter(fav => fav.id !== currentQuote.id);
          showNotification('Removed from favorites');
        } else {
          favorites.push(currentQuote);
          showNotification('Added to favorites! ❤️');
        }
        localStorage.setItem('favorites', JSON.stringify(favorites));
        updateStats();
      });
      
      document.getElementById('shareBtn').addEventListener('click', () => {
        if (!currentQuote) return;
        const textToShare = currentQuote.text + "\n— " + currentQuote.source;
        if (navigator.share) {
          navigator.share({ text: textToShare }).catch(console.error);
        } else {
          showNotification("Share not supported. Copy and share manually.");
        }
      });
      
      document.getElementById('copyBtn').addEventListener('click', () => {
        if (!currentQuote) return;
        const textToCopy = currentQuote.text + "\n— " + currentQuote.source;
        navigator.clipboard.writeText(textToCopy).then(() => {
          showNotification("Blessing copied to clipboard! 📋");
        });
      });
      
      document.getElementById('closeCard').addEventListener('click', closeQuoteCard);

      // Quick Actions
      document.getElementById('randomBlessingBtn').addEventListener('click', generatePassage);
      
      document.getElementById('favoritesBtn').addEventListener('click', () => {
        if (favorites.length === 0) {
          showNotification("No favorites saved yet. Save some blessings first! ❤️");
          return;
        }
        const randomFavorite = favorites[Math.floor(Math.random() * favorites.length)];
        currentQuote = randomFavorite;
        displayQuote(randomFavorite);
        showNotification("Showing a favorite blessing! ❤️");
      });
      
      document.getElementById('settingsBtn').addEventListener('click', () => {
        showNotification("Settings: Use the dropdowns above to customize your experience! ⚙️");
      });
setupCardInteractions();
      showNotification('🙏🏻 Welcome to Blessing of Siam! Click ☀️ to start 🙏🏻');

      if (window.speechSynthesis) {
        window.speechSynthesis.onvoicesc0hanged = () => {
          console.log("Voices loaded:", window.speechSynthesis.getVoices());
        };
        window.speechSynthesis.getVoices();
      }

      generatePassage();
    });
  </script>
</body>
</html>


      
